# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура и ключевые компоненты

Архитектура проекта построена на паттерне **Model–View–Controller (MVC)**:

- **Model** - управление данными и бизнес-логикой (`CatalogModel`, `BasketModel`, `OrderModel`)
- **View** - отображение интерфейса и взаимодействие с DOM (`Card`, `CardPreview`, `OrderView`, `ContactsView`, и др.)
- **Controller** - координация всех компонентов (класс `App`)

Каждый модуль отвечает за свою зону ответственности, что облегчает поддержку, тестирование и масштабирование приложения.

### Каталог (Catalog)

Хранит и предоставляет данные обо всех товарах, позволяет получать список товаров и показывает отдельно каждый товар по модификатору. Описывается интерфейсом `IProduct` и моделью `CatalogModel`.

### Корзина (Basket)

Предоставляет возможность добавлять и удалять товар, хранит элементы корзины. Действия с корзиной и ее возможности описаны через интерфейс `IBasketItem` и модель `BasketModel`

### Оформление заказа (Order)

Собирает и валидирует данные пользователя (`IForm`, `IOrder`, `IUser`), обеспечивает переход к оплате, сохраняет информацию о способе оплаты, адресе, email и телефоне пользователя. Данные хранятся в модели OrderModel и отображены с помощью view-классов `OrderView` и `ContactsView`.

### EventEmitter

Событийный брокер и перечисление событий, с которыми работает приложение. Позволяет подписываться на события и отправлять оповещения между частями приложения, реализует шаблон “наблюдатель”. Таким образом, при добавлении товара в корзину, UI будет обновлять счетчик товара и уведомлять (показывать) пользователя.

У класса будут прописаны методы `on`, `off` и `emit`. On(event, listener) - подписка на событие, off - соответственно, отписка, и emit - вызов события. 

Примеры событий, которые будут реализованы в коде:

- `catalog:loaded` - загрузился каталог товаров
- `product:select` - пользователь открыл карточку товара
- `basket:add` - добавлен товар в корзину
- и т.д.

### API-клиент (LarekApi)

Обеспечивает запросы к серверу для получения каталога товаров и отправки заказа.

Класс LarekApi реализует API-клиент и обеспечит получение каталога товаров (`getItems`) и оформление заказов (`createOrder`). Всё сетевое взаимодействие с сервером инкапсулировано в этом классе.

В проекте также используется универсальный дженерик-тип `ApiListResponse<T>`, который позволяет типизировать ответы API, возвращающие коллекции данных.

**Структура ответа включает:**

- `total` - общее количество элементов;
- `items` - массив элементов типа `T`

**Пример использования:**

- Для списка товаров: `ApiListResponse<IProduct>`
- Для списка заказов: `ApiListResponse<IOrder>`

### App - центральный контроллер приложения

Класс `App` управляет взаимодействием между всеми компонентами приложения: загрузкой данных с API, отрисовкой карточек, отображением модальных окон, логикой корзины и заказов.

**Конструктор:**

`constructor(...)` принимает все зависимости - API, модели, представления, события, и связывает их внутри метода `init()`.

**Методы:**

- `init()` - точка инициализации приложения: подписки на события, начальная отрисовка каталога.
- `updateCounter()` - обновление количества товаров в корзине.

### ProductListView

**Назначение:** отображает карточки товаров в списке. Управляет контейнером, в который добавляются карточки.

**Методы:**

- `render(products: IProduct[]): void` - отрисовать товары на странице

### Page

**Назначение:** отвечает за элементы интерфейса страницы, такие как счётчик товаров и кнопка открытия корзины.

**Методы:**

- `set counter(value: number)` - обновление количества товаров в корзине
- `set catalog(items: HTMLElement[])` - размещает каталог на странице
- `set locked(value: boolean)` - блокирует положение страницы при открытии модального окна

## Модели (Models)

### BasketModel

**Назначение:** хранение данных о корзине пользователя и реализация методов для добавления и удаления товаров.

**Конструктор:** `constructor(private events: IEvents)`

**Поля:**

- `protected items: string[] = []` — массив `id` добавленных товаров

**Методы:**

- `addItem(id: string): boolean` - добавить товар по id
- `removeItem(id: string)` - удалить товар
- `getItems()` - получить список товаров в корзине
- `clear()` - очистить корзину
- `hasItem(id: string): boolean` - проверка наличия товара в корзине

### CatalogModel

**Назначение:** управление списком товаров (каталог), хранение и предоставление товаров по запросу.

**Конструктор:** `constructor(protected events: IEvents)`

**Поля:**

- `protected items: IProduct[] = []`

**Методы:**

- `setItems(items: IProduct[])` - обновить содержимое каталога
- `getItems(): IProduct[]` - получить товары из внутреннего массива товаров
- `getItemById(id: string): IProduct` - предоставить товар из внутреннего массива товаров

### OrderModel

**Назначение:** хранение и валидация данных оформления заказа пользователя.

**Поля:**

`private data: Partial<IOrder> = {}`

**Методы:**

- `setUser(user: IUser): void` - записать/обновить данные пользователя в текущем заказе.
- `setForm(form: IForm)` - записать данные (способ оплаты и адрес доставки) из формы заказа
- `setItems(items: string[])` - записать список заказанных товаров
- `setTotal(total: number)` - записать общую сумму заказанных товаров
- `getOrder(): IOrder | null` - вернуть итоговый объект заказа
- `clear()` - очистить форму заказа

Валидация данных заказа осуществляется методом `getOrder()`, который возвращает `null`, если какие-либо поля заказа отсутствуют.

## Представления

### SuccessView

**Назначение:** показывает модальное окно об успешном оформлении заказа.

**Конструктор:** `constructor(protected template: HTMLTemplateElement, protected events: IEvents)`

**Поля:**

- `template: HTMLTemplateElement` - корневой элемент для модального окна.
- `events: IEvents` - события в модальном окне

**Методы:**

- `set total(id: number)` - данные о сумме заказа

### Card

**Назначение:** отображает карточку товара, показывает информацию о товаре и позволяет открыть превью

**Конструктор:** `constructor(container: HTMLElement, protected events: IEvents)`

**Поля:**

- `container: HTMLElement` - родительский DOM-элемент, в который будет вставлена карточка.
- `events: IEvents` - для отправки событий.

**Методы:**

- `render(data: Partial<IProduct>): HTMLElement` - создаёт DOM-элемент карточки товара на основе переданных полей (без описания).

### CardPreview

**Назначение:** показывает модальное окно с подробной информацией о товаре и позволяет добавить его в корзину.

**Конструктор:** `constructor(protected template: HTMLTemplateElement, protected events: IEvents)`

**Поля:**

- `template: HTMLTemplateElement` - темплейт превью карточки
- `events: IEvents` - для отправки событий.

**Методы:**

- `render(data: IProduct): HTMLElement` - формирует полную карточку товара в модалке, включая описание и категорию.
- `setInBasketState(isInBasket: boolean)` - блокирует кнопку, если товар уже в корзине

### BasketView

**Назначение:** отображает карточку товара в корзине с возможностью удаления.

**Конструктор:** `constructor(protected template: HTMLTemplateElement, protected events: IEvents)`

**Поля:**

- `template: HTMLTemplateElement` - темплейт превью карточки
- `events: IEvents` - для отправки событий.

### OrderView

**Назначение:** позволяет выбрать способ оплаты и вписать адрес пользователя для последующего оформления заказа, а также выполняет валидацию и отправку данных.

**Конструктор:** `constructor(protected template: HTMLTemplateElement, protected events: IEvents)`

**Поля:**

- `template: HTMLTemplateElement` - темплейт превью карточки
- `events: IEvents` - для отправки событий.

**Методы:**

- `render(): HTMLElement` - создает и возвращает DOM-элемент формы заказа
- `updateButtonState()` - управляет кнопкой “Далее”

### ContactsView

**Назначение:** позволяет вписать контактные данные пользователя, такие как телефон и email с последующей возможностью оформить заказ, а также выполняет валидацию и отправку данных.

**Конструктор:** `constructor(protected template: HTMLTemplateElement, protected events: IEvents)`

**Поля:**

- `template: HTMLTemplateElement` - темплейт превью карточки
- `events: IEvents` - для отправки событий.

**Методы:**

- `render(): HTMLElement` - создает и возвращает DOM-элемент формы заказа
- `validate(): boolean` - проверяет корректность введенных данных
